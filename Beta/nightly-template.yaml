# This template is used by cloudbuild.yaml to build and update all of the
# Cloud Builders.
# Executing the following command in this directory will use this template to
# build and push all images:
# gcloud builds submit --substitutions=_TEMPLATE=nightly-template.yaml

steps:
- name: 'gcr.io/cloud-builders/docker'
  args:
  - 'build'
  - '--tag=us-docker.pkg.dev/$PROJECT_ID/cloud-builders/${_STEP}'
  - '--tag=europe-docker.pkg.dev/$PROJECT_ID/cloud-builders/${_STEP}'
  - '--tag=asia-docker.pkg.dev/$PROJECT_ID/cloud-builders/${_STEP}'
  - '--tag=us-docker.pkg.dev/$PROJECT_ID/cloud-builders/${_STEP}:${_YYYYMMDD}'
  - '--tag=europe-docker.pkg.dev/$PROJECT_ID/cloud-builders/${_STEP}:${_YYYYMMDD}'
  - '--tag=asia-docker.pkg.dev/$PROJECT_ID/cloud-builders/${_STEP}:${_YYYYMMDD}'
  - '.'
images:
- 'us-docker.pkg.dev/$PROJECT_ID/cloud-builders/${_STEP}:latest'
- 'europe-docker.pkg.dev/$PROJECT_ID/cloud-builders/${_STEP}:latest'
- 'asia-docker.pkg.dev/$PROJECT_ID/cloud-builders/${_STEP}:latest'
- 'us-docker.pkg.dev/$PROJECT_ID/cloud-builders/${_STEP}:${_YYYYMMDD}'
- 'europe-docker.pkg.dev/$PROJECT_ID/cloud-builders/${_STEP}:${_YYYYMMDD}'
- 'asia-docker.pkg.dev/$PROJECT_ID/cloud-builders/${_STEP}:${_YYYYMMDD}'
timeout: 900s
