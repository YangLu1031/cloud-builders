# In this directory, run the following command to build this build step.
# gcloud builds submit --substitutions=_YYYYMMDD=$(date +%Y%m%d)

steps:
- name: 'gcr.io/cloud-builders/docker'
  args:
  - 'build'
  - '--tag=us-docker.pkg.dev/$PROJECT_ID/cloud-builders/terraform'
  - '--tag=europe-docker.pkg.dev/$PROJECT_ID/cloud-builders/terraform'
  - '--tag=asia-docker.pkg.dev/$PROJECT_ID/cloud-builders/terraform'
  - '--tag=us-docker.pkg.dev/$PROJECT_ID/cloud-builders/terraform:${_YYYYMMDD}'
  - '--tag=europe-docker.pkg.dev/$PROJECT_ID/cloud-builders/terraform:${_YYYYMMDD}'
  - '--tag=asia-docker.pkg.dev/$PROJECT_ID/cloud-builders/terraform:${_YYYYMMDD}'
  - '.'
images:
- 'us-docker.pkg.dev/$PROJECT_ID/cloud-builders/terraform:latest'
- 'europe-docker.pkg.dev/$PROJECT_ID/cloud-builders/terraform:latest'
- 'asia-docker.pkg.dev/$PROJECT_ID/cloud-builders/terraform:latest'
- 'us-docker.pkg.dev/$PROJECT_ID/cloud-builders/terraform:${_YYYYMMDD}'
- 'europe-docker.pkg.dev/$PROJECT_ID/cloud-builders/terraform:${_YYYYMMDD}'
- 'asia-docker.pkg.dev/$PROJECT_ID/cloud-builders/terraform:${_YYYYMMDD}'
timeout: 900s
