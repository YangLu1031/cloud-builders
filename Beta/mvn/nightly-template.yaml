# This template is used by cloudbuild.yaml in our parent directory.

steps:
- name: 'gcr.io/cloud-builders/docker'
  args:
  - 'build'
  - '--tag=us-docker.pkg.dev/$PROJECT_ID/cloud-builders/${_STEP}'
  - '--tag=europe-docker.pkg.dev/$PROJECT_ID/cloud-builders/${_STEP}'
  - '--tag=asia-docker.pkg.dev/$PROJECT_ID/cloud-builders/${_STEP}'
  - '--tag=us-docker.pkg.dev/$PROJECT_ID/cloud-builders/${_STEP}:${_YYYYMMDD}'
  - '--tag=europe-docker.pkg.dev/$PROJECT_ID/cloud-builders/${_STEP}:${_YYYYMMDD}'
  - '--tag=asia-docker.pkg.dev/$PROJECT_ID/cloud-builders/${_STEP}:${_YYYYMMDD}'
  - '.'
- name: 'gcr.io/cloud-builders/docker'
  args:
  - 'build'
  - '-f'
  - 'Dockerfile.appengine'
  - '--tag=us-docker.pkg.dev/$PROJECT_ID/cloud-builders/${_STEP}:appengine'
  - '--tag=europe-docker.pkg.dev/$PROJECT_ID/cloud-builders/${_STEP}:appengine'
  - '--tag=asia-docker.pkg.dev/$PROJECT_ID/cloud-builders/${_STEP}:appengine'
  - '--tag=us-docker.pkg.dev/$PROJECT_ID/cloud-builders/${_STEP}:appengine-${_YYYYMMDD}'
  - '--tag=europe-docker.pkg.dev/$PROJECT_ID/cloud-builders/${_STEP}:appengine-${_YYYYMMDD}'
  - '--tag=asia-docker.pkg.dev/$PROJECT_ID/cloud-builders/${_STEP}:appengine-${_YYYYMMDD}'
  - '.'
images:
- 'us-docker.pkg.dev/$PROJECT_ID/cloud-builders/${_STEP}:latest'
- 'europe-docker.pkg.dev/$PROJECT_ID/cloud-builders/${_STEP}:latest'
- 'asia-docker.pkg.dev/$PROJECT_ID/cloud-builders/${_STEP}:latest'
- 'us-docker.pkg.dev/$PROJECT_ID/cloud-builders/${_STEP}:${_YYYYMMDD}'
- 'europe-docker.pkg.dev/$PROJECT_ID/cloud-builders/${_STEP}:${_YYYYMMDD}'
- 'asia-docker.pkg.dev/$PROJECT_ID/cloud-builders/${_STEP}:${_YYYYMMDD}'
- 'us-docker.pkg.dev/$PROJECT_ID/cloud-builders/${_STEP}:appengine'
- 'europe-docker.pkg.dev/$PROJECT_ID/cloud-builders/${_STEP}:appengine'
- 'asia-docker.pkg.dev/$PROJECT_ID/cloud-builders/${_STEP}:appengine'
- 'us-docker.pkg.dev/$PROJECT_ID/cloud-builders/${_STEP}:appengine-${_YYYYMMDD}'
- 'europe-docker.pkg.dev/$PROJECT_ID/cloud-builders/${_STEP}:appengine-${_YYYYMMDD}'
- 'asia-docker.pkg.dev/$PROJECT_ID/cloud-builders/${_STEP}:appengine-${_YYYYMMDD}'
timeout: 900s
